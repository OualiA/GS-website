<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books & References â€” Green Science</title>
  <link rel="icon" href="../SS.ico">
  <meta name="theme-color" content="#0a0f0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta property="og:title" content="Books & References â€” Green Science">
  <meta property="og:description" content="Browse and download all books and references available on Green Science.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="../favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Noto+Kufi+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <noscript><div style="text-align:center;padding:80px 20px;font-family:sans-serif;color:#ccc;background:#0a0f0a;min-height:100vh"><h1 style="color:#2ECC71">Green Science</h1><p>JavaScript is required to use this site.</p></div></noscript>
  <div class="bg-layer"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>
  <div class="grain"></div>

  <nav class="nav-bar" role="navigation" aria-label="Main navigation"><div class="nav-inner">
    <a href="../index.html" class="nav-brand">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      <span data-i18n="siteName">Green Science</span>
    </a>
    <div class="nav-right">
      <button class="theme-btn" onclick="toggleTheme()" aria-label="Toggle theme"><svg class="theme-icon-light" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg class="theme-icon-dark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button>
      <button class="search-btn" onclick="openSearch()" title="Search (Ctrl+K)" aria-label="Search"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></button>
      <div class="lang-btns">
        <button class="lang-btn active" onclick="setLang('en')" aria-label="English">EN</button>
        <button class="lang-btn" onclick="setLang('fr')" aria-label="FranÃ§ais">FR</button>
        <button class="lang-btn" onclick="setLang('ar')" aria-label="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø¹Ø±Ø¨ÙŠ</button>
      </div>
    </div>
  </div></nav>

  <main class="wrap" id="main" role="main"></main>

<script src="../js/config.js"></script>
<script src="../js/i18n.js"></script>
<script src="../js/data.js"></script>
<script src="../js/modules/soil.js"></script>
<script src="../js/modules/plant.js"></script>
<script src="../js/modules/climate.js"></script>
<script src="../js/modules/stat.js"></script>
<script src="../js/news.js"></script>
<script src="../js/engine.js"></script>
<script>

var allBooks = [];
var activeModFilter = 'all';
var bookSearch = '';
var booksPage = 1;
var BOOKS_PER_PAGE = 8;

function onLangChange() { render(); }

function getModId(entry) {
  var m = entry.href.match(/[?&]id=([^&]+)|[?&]mod=([^&]+)/);
  return m ? (m[1] || m[2]) : 'unknown';
}

function getModuleCounts() {
  var counts = {};
  allBooks.forEach(function(entry) {
    var modId = getModId(entry);
    counts[modId] = (counts[modId] || 0) + 1;
  });
  return counts;
}

function getFilteredBooks() {
  return allBooks.filter(function(entry) {
    if (activeModFilter !== 'all' && getModId(entry) !== activeModFilter) return false;
    if (bookSearch) {
      var q = bookSearch.toLowerCase();
      var title = (localText(entry.book.title) || '').toLowerCase();
      var author = entry.book.author ? (localText(entry.book.author) || '').toLowerCase() : '';
      var source = (localText(entry.source) || '').toLowerCase();
      if (title.indexOf(q) === -1 && author.indexOf(q) === -1 && source.indexOf(q) === -1) return false;
    }
    return true;
  });
}

function render() {
  allBooks = getAllBooks();
  document.title = tr('booksAllTitle') + ' â€” Green Science';
  var el = document.getElementById('main');
  var h = '';

  h += '<div class="breadcrumb">' +
    '<a href="' + ROOT + 'index.html">' + tr('backHome') + '</a>' +
    '<span class="sep">â€º</span>' +
    '<span class="current">' + tr('booksAllTitle') + '</span></div>';

  h += '<div class="page-hero">' +
    '<div class="page-icon" style="background:linear-gradient(135deg,#8B5CF6,#6D28D9)">ðŸ“š</div>' +
    '<div><h1 class="page-title">' + tr('booksAllTitle') + '</h1>' +
    '<p class="page-desc">' + allBooks.length + ' ' + tr('booksSection').toLowerCase() + '</p></div></div>';

  h += '<div class="books-toolbar">';
  h += '<input class="books-search" type="text" placeholder="' + tr('booksSearchPh') + '" value="' + bookSearch.replace(/"/g, '&quot;') + '" oninput="bookSearch=this.value;booksPage=1;renderResults()" />';
  h += '</div>';

  var counts = getModuleCounts();
  h += '<div class="books-filters">';
  h += '<button class="books-filter-btn' + (activeModFilter === 'all' ? ' active' : '') + '" onclick="setModFilter(\'all\')">ðŸ“‹ ' + tr('newsFilterAll') + ' <span class="books-filter-count">(' + allBooks.length + ')</span></button>';
  modules.forEach(function(mod) {
    var c = counts[mod.id] || 0;
    if (c === 0) return;
    h += '<button class="books-filter-btn' + (activeModFilter === mod.id ? ' active' : '') + '" onclick="setModFilter(\'' + mod.id + '\')">' +
      mod.icon + ' ' + localText(mod.title) + ' <span class="books-filter-count">(' + c + ')</span></button>';
  });
  h += '</div>';

  h += '<div id="booksResults"></div>';

  h += '<footer><div id="contactSlot"></div><div style="margin-top:16px">&copy; 2025 Green Science &mdash; <a href="https://www.youtube.com/@greenscience-9226">' + tr('footerLink') + '</a></div></footer>';

  el.innerHTML = h;
  renderContactLinks();
  renderResults();
}

function renderResults() {
  var container = document.getElementById('booksResults');
  if (!container) return;
  var filtered = getFilteredBooks();

  if (filtered.length === 0) {
    container.innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:56px;height:56px;margin-bottom:12px;opacity:0.3"><path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg><p>' + tr('booksNoResults') + '</p></div>';
    return;
  }

  var totalPages = Math.ceil(filtered.length / BOOKS_PER_PAGE);
  if (booksPage > totalPages) booksPage = totalPages;
  if (booksPage < 1) booksPage = 1;

  var start = (booksPage - 1) * BOOKS_PER_PAGE;
  var pageItems = filtered.slice(start, start + BOOKS_PER_PAGE);

  var h = '<div class="books-count">' + tr('booksSection') + ' ' + (start + 1) + 'â€“' + Math.min(start + BOOKS_PER_PAGE, filtered.length) + ' ' + tr('pageOf') + ' ' + filtered.length + '</div>';
  h += '<div class="books-full-grid">';

  pageItems.forEach(function(entry) {
    var bk = entry.book;
    var coverHtml = bk.cover
      ? '<img class="book-cover" src="' + ROOT + bk.cover + '" alt="' + localText(bk.title) + '" loading="lazy" onerror="coverFallback(this)">'
      : '<div class="book-cover book-cover-placeholder">' + (bk.icon || 'ðŸ“•') + '</div>';
    var auth = bk.author ? '<div class="book-author">' + tr('bookBy') + ' ' + localText(bk.author) + '</div>' : '';
    var sourceHtml = '<div class="book-card-source"><span class="book-card-source-icon" style="background:' + entry.sourceGrad + '">' + entry.sourceIcon + '</span> ' + localText(entry.source) + '</div>';

    h += '<div class="book-card">' + coverHtml +
      '<div class="book-card-info"><div class="book-card-title">' + localText(bk.title) + '</div>' + auth + sourceHtml + '</div>';
    if (bk.file) {
      h += '<a href="' + bk.file + '" target="_blank" rel="noopener" class="book-card-dl">' + dlSvg + ' ' + tr('download') + '</a>';
    }
    h += '</div>';
  });

  h += '</div>';
  h += buildPagination(booksPage, totalPages, 'goBooksPage');
  container.innerHTML = h;
}

function goBooksPage(p) {
  booksPage = p;
  renderResults();
  var container = document.getElementById('booksResults');
  if (container) container.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function setModFilter(id) {
  activeModFilter = id;
  booksPage = 1;
  render();
  var input = document.querySelector('.books-search');
  if (input) input.value = bookSearch;
}

setLang(initLang());
</script>
</body>
</html>
